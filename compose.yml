services:
  proxy:
    image: caddy:2
    ports:
      - "80:80"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
    networks:
      - hub

  mechbay:
    build: ./MechBay
    expose:
      - "5000"
    environment:
      - APPLICATION_ROOT=/mechbay
    volumes:
      - mechbay-data:/data
    networks:
      - hub
    profiles: ['home']

  waypoint:
    build: ./waypoint
    expose:
      - "5000"
    environment:
      - APPLICATION_ROOT=/waypoint
      - DATABASE_URL=sqlite:////data/waypoint.db
      - FLASK_SECRET_KEY=waypoint-secret-key-hub-2026
      - BACKUP_PATH=/data/backups
    volumes:
      - waypoint-data:/data
    networks:
      - hub
    profiles: ['work', 'home']

  timetracker:
    build: ./timetracker
    expose:
      - "5000"
    environment:
      - APPLICATION_ROOT=/timetracker
      - SQLALCHEMY_DATABASE_URI=sqlite:///data/time-tracker.db
      - SECRET_KEY=this_is_my_secret_key_217149
      - DAY_START_TIME=08:30
      - DAY_END_TIME=17:00
    volumes:
      - timetracker-data:/app/data
    networks:
      - hub
    profiles: ['work', 'home']

networks:
  hub:
    driver: bridge

volumes:
  mechbay-data:
  waypoint-data:
  timetracker-data:
  timetracker-instance:
