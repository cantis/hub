services:
  proxy:
    image: caddy:2
    ports:
      - "80:80"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
    networks:
      - hub

  mechbay:
    build: ./MechBay
    expose:
      - "5000"
    environment:
      - APPLICATION_ROOT=/mechbay
    volumes:
      - mechbay-data:/data
    networks:
      - hub
    profiles: ['home']

  waypoint:
    build: ./waypoint
    expose:
      - "5000"
    environment:
      - APPLICATION_ROOT=/waypoint
      - DATABASE_URL=sqlite:////data/app.db
    volumes:
      - waypoint-data:/data
    networks:
      - hub
    profiles: ['work', 'home']

  timetracker:
    build: ./timetracker
    expose:
      - "5000"
    environment:
      - APPLICATION_ROOT=/timetracker
    volumes:
      - timetracker-data:/app/data
      - timetracker-instance:/app/instance
    networks:
      - hub
    profiles: ['work', 'home']

networks:
  hub:
    driver: bridge

volumes:
  mechbay-data:
  waypoint-data:
  timetracker-data:
  timetracker-instance:
